<div class="dark-background">
  <div class="container">
    <h2 class="text-center pt-4 mb-2"><%= @event.name %></h2>
    <p class="created-by text-center">Created by <strong><%= link_to @user.username, profile_path(@user.username) %></strong></p>
    <% if current_user != @user %>
      <span class="msg-link"><%= link_to "Message #{@user.username}", chats_path(sender_id: current_user, recipient_id: @user.id), method: :post %><i class="far fa-comment-dots"></i></span>
    <% end %>



    <p class="text-center my-4 location"><i class="fas fa-map-marker-alt"></i> <span class="ml-3"><%= @event.court.address %></span></p>
    <div class="d-flex justify-content-around event-info">
      <p><i class="far fa-calendar-alt"></i> <span class="ml-3"><%= @event.date %></span></p>
      <p><i class="far fa-clock"></i> <span class="ml-3"><%= @event.time == nil ? "00:00" : @event.time.strftime('%H:%M') %></span></p>
      <p><i class="fas fa-users"></i> <span class="ml-3"><%= @event.event_users.count %> / <%= @event.num_of_players %></span></p>
    </div>

    <div class="d-flex justify-content-around">
      <% if current_user %>

        <% if @event.is_event_full? || @event.is_past_event? %>
          <%= button_to "Join Event", court_event_event_users_path(@court, @event), method: :post, class: "large-button text-center disabled-button", disabled: true %>
        <% elsif @event.is_user_registered?(current_user.id) %>
          <%= button_to "Join Event", court_event_event_users_path(@court, @event), method: :post, class: "large-button text-center disabled-button", disabled: true %>
            <% if policy(@event_user).destroy? %>
              <%= button_to "Unjoin event", court_event_event_user_path(@court, @event), class: "all-buttons white-button large-button text-center", action: :destroy, method: :delete %>
            <% end %>
        <% else %>
          <%= button_to "Join Event", court_event_event_users_path(@court, @event), method: :post, class: "all-buttons pink-button large-button text-center" %>
        <% end %>

      <% else %>
        <%= button_to "Join Event", court_event_event_users_path(@court, @event), method: :post, class: "all-buttons pink-button large-button text-center" %>
      <% end %>

      <% if current_user %>
        <% if policy(@event).edit? && !@event.is_past_event? %>
          <%= link_to "Edit", edit_court_event_path(@court, @event), class: "all-buttons white-button large-button text-center" %>
        <% end %>
      <% end %>
    </div>
    <div class="players-joined mt-5">
      <p>Players joined (<%= @event.event_users.count %>):</p>
      <ul>
        <% @event.event_users.each do |event_user| %>
          <li>id: <%= event_user.id %> --- <%= event_user.user.username %> ---
            <% if current_user %>
              <% if @event.is_user_registered?(current_user.id) %>
                <% if !event_user.is_event_user_rated?(event_user.id, current_user.id, event_user.user.id) %>
                  <% if current_user.id != event_user.user.id %>
                    <%= link_to "Rate #{event_user.user.username}", new_court_event_event_user_review_path(event_id: params[:id], event_user_id: event_user.id) %>
                  <% end %>
                <% else %>
                  <% event_user.reviews.each do |review| %>
                    <% if review.rated_event_user_id == event_user.user.id && review.rating_event_user_id == current_user.id %>
                      <%= review.rating %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>

  </div> <!-- END OF CONTAINER -->
</div>
